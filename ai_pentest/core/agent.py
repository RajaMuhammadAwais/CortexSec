from typing import List, Dict, Any, Optional
from pydantic import BaseModel, Field
from ai_pentest.llm.base import BaseLLM
import logging

# Configure logging
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
logger = logging.getLogger("ai-pentest")

class Finding(BaseModel):
    """Represents a single security finding."""
    title: str
    description: str
    severity: str  # Low, Medium, High, Critical
    confidence: float  # 0.0 to 1.0
    evidence: str
    mitigation: Optional[str] = None
    owasp_mapping: Optional[str] = None
    mitre_mapping: Optional[str] = None

class PentestContext(BaseModel):
    """Shared state across all agents."""
    target: str
    mode: str = "lab"
    findings: List[Finding] = Field(default_factory=list)
    recon_data: Dict[str, Any] = Field(default_factory=dict)
    scan_data: Dict[str, Any] = Field(default_factory=dict)
    history: List[Dict[str, Any]] = Field(default_factory=list)

class BaseAgent:
    """
    Base class for all specialized agents.
    """
    def __init__(self, name: str, llm: BaseLLM):
        self.name = name
        self.llm = llm

    def log(self, message: str):
        logger.info(f"[{self.name}] {message}")

    def run(self, context: PentestContext) -> PentestContext:
        """Executes the agent's logic."""
        raise NotImplementedError("Subclasses must implement run()")
